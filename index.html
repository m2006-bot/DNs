<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wateen OS Elite - iPhone Edition</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wateen OS">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    
    <link rel="apple-touch-icon" href="https://iili.io/fkhg119.jpg">
    <link rel="icon" href="https://iili.io/fkhg119.jpg">

    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #000000;
            --ios-gray: #1c1c1e;
            --accent: #00f3ff;
            --gold: #ffd700;
            --pink: #ff2d55;
            --timer-fs: clamp(6rem, 28vw, 10rem);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; padding: 0; 
            -webkit-user-select: none; user-select: none;
            -webkit-touch-callout: none; -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Tajawal", sans-serif;
        }

        body {
            background-color: var(--bg); color: #fff;
            height: 100dvh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* Splash Screen (10s) */
        #splash {
            position: fixed; inset: 0; background: #000; z-index: 100000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 35px; text-align: center; transition: 1.2s ease-in-out;
        }
        .splash-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); padding: 30px; border-radius: 32px; max-width: 450px; }
        .splash-logo { width: 85px; height: 85px; border-radius: 22px; border: 2px solid var(--accent); margin-bottom: 20px; box-shadow: 0 0 20px rgba(0,243,255,0.2); }
        .m-name { color: var(--gold); font-weight: 900; text-shadow: 0 0 10px rgba(255, 215, 0, 0.4); }
        .loading-bar { width: 100%; height: 4px; background: #222; border-radius: 10px; margin-top: 25px; overflow: hidden; }
        .loading-fill { width: 0%; height: 100%; background: var(--accent); animation: load 10s linear forwards; }
        @keyframes load { to { width: 100%; } }

        /* Custom iOS Modal */
        #ios-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px);
            z-index: 2000000; display: none; align-items: center; justify-content: center; padding: 25px;
        }
        .modal-content {
            background: #1c1c1e; width: 100%; max-width: 280px; border-radius: 20px;
            padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-btns { display: flex; flex-direction: column; gap: 1px; background: #3a3a3c; margin-top: 20px; border-radius: 12px; overflow: hidden; }
        .m-btn { padding: 15px; border: none; font-size: 1.1rem; background: #1c1c1e; color: #0a84ff; cursor: pointer; font-weight: 500; outline: none; }
        .m-btn-reset { color: #ff453a; font-weight: 700; border-bottom: 1px solid #3a3a3c; }

        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: clamp(60px, 12vh, 85px) 25px 30px; }
        .widget { width: 33%; background: var(--ios-gray); padding: 14px; border-radius: 22px; border: 1px solid rgba(255,255,255,0.05); }
        .widget-label { font-size: 0.65rem; color: #8e8e93; font-weight: 900; display: block; margin-bottom: 2px; }
        .widget-val { font-size: 1.3rem; font-weight: 800; color: var(--accent); letter-spacing: -0.5px; }

        .main-container { flex: 1; display: flex; flex-direction: column; padding: 0 25px env(safe-area-inset-bottom); }

        .input-wrapper { background: var(--ios-gray); padding: 18px; border-radius: 22px; display: flex; align-items: center; gap: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.03); }
        .input-wrapper input { flex: 1; background: transparent; border: none; color: #fff; font-size: 1.1rem; outline: none; font-weight: 500; }
        .input-wrapper input::placeholder { color: #636366; }

        .task-scroll { flex: 1; overflow-y: auto; padding-right: 5px; }
        .task-card { background: var(--ios-gray); padding: 20px; border-radius: 22px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; transition: 0.3s; }
        .task-card.done { opacity: 0.25; transform: scale(0.98); }
        .task-card.done span { text-decoration: line-through; }
        .check-icon { width: 28px; height: 28px; border: 2.5px solid #3a3a3c; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .check-icon.active { background: var(--accent); border-color: var(--accent); color: #000; }

        .timer-box { text-align: center; margin-top: auto; padding-bottom: 20px; }
        .time-val { font-size: var(--timer-fs); font-weight: 200; letter-spacing: -7px; font-variant-numeric: tabular-nums; }

        .footer-rights { text-align: center; font-size: 0.8rem; padding: 15px 0; font-weight: 700; color: #444; }
        .footer-rights a { color: var(--accent); text-decoration: none; }

        .action-row { display: grid; grid-template-columns: 1fr 75px; gap: 15px; padding-bottom: 45px; }
        .btn { height: 72px; border-radius: 24px; border: none; font-weight: 900; font-size: 1.4rem; transition: 0.2s; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .btn:active { transform: scale(0.95); opacity: 0.8; }
        .btn-play { background: #fff; color: #000; }
        .btn-play.active { background: var(--pink); color: #fff; }
        .btn-off { background: var(--ios-gray); color: #fff; font-size: 1.6rem; }

        /* iPhone Toast Notification */
        .toast { position: fixed; top: -120px; left: 20px; right: 20px; background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(30px); padding: 22px; border-radius: 28px; z-index: 1000000; display: flex; align-items: center; gap: 18px; transition: 0.7s cubic-bezier(0.19, 1, 0.22, 1); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .toast.show { top: 65px; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="splash-card">
            <img src="https://iili.io/fkhg119.jpg" class="splash-logo">
            <h1 style="font-size: 2.2rem; font-weight: 900; margin-bottom: 15px; letter-spacing: -1px;">WATEEN OS</h1>
            <div style="font-size: 1rem; line-height: 1.8; color: #8e8e93; font-weight: 500;">
                ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø§Ù„ØµÙØ± ÙˆØ¨Ø§Ø¹ØªÙ…Ø§Ø¯ Ø°Ø§ØªÙŠ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬Ø© <span class="m-name">Ù…Ø±ÙˆØ© Ù…Ø­Ù…Ø¯</span>. Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ ÙŠØ¹ØªÙ…Ø¯ ØªÙ‚Ù†ÙŠØ© 40 Ø¯Ù‚ÙŠÙ‚Ø© Ø¯Ø±Ø§Ø³Ø© + 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ø³ØªØ±Ø§Ø­Ø©.
                <br><br>
                ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø¥Ù†Ø¬Ø§Ø² 8 Ø³Ø§Ø¹Ø§Øª Ø¯Ø±Ø§Ø³Ø© ÙØ¹Ù‘Ø§Ù„Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹.
                <br><br>
                <span id="greetText" style="color:#fff; font-weight:800;"></span>
            </div>
            <div class="loading-bar"><div class="loading-fill"></div></div>
        </div>
    </div>

    <div id="ios-modal">
        <div class="modal-content">
            <h3 style="color:#fff; margin-bottom:8px">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·</h3>
            <p style="color:#8e8e93; font-size:0.95rem">Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙŠØ§ Ù…Ø±ÙˆØ©ØŸ</p>
            <div class="modal-btns">
                <button class="m-btn m-btn-reset" onclick="appReset()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø­</button>
                <button class="m-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <div style="width:45px; height:45px; background:var(--accent); border-radius:14px; display:flex; align-items:center; justify-content:center; color:#000;">
            <i class="fas fa-comment-dots" style="font-size:1.3rem"></i>
        </div>
        <span id="toastMsg" style="font-weight:700; font-size:1rem; line-height:1.4"></span>
    </div>

    <div class="top-nav">
        <div class="widget"><span class="widget-label">REST SESS</span><span class="widget-val" id="rc">0/12</span></div>
        <div style="text-align:center">
            <img src="https://iili.io/fkhg119.jpg" style="width:55px; height:55px; border-radius:50%; border:2.5px solid var(--accent)">
            <p style="font-size:0.65rem; font-weight:900; margin-top:6px; color:#8e8e93; letter-spacing: 1px;">WATEEN PRO</p>
        </div>
        <div class="widget" style="text-align:left"><span class="widget-label">STUDY SESS</span><span class="widget-val" id="sc">0/12</span></div>
    </div>

    <div class="main-container">
        <div class="task-scroll">
            <div class="input-wrapper">
                <input type="text" id="taskInp" placeholder="Ø§ÙƒØªØ¨ÙŠ Ù‡Ø¯Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯...">
                <i class="fas fa-plus-circle" style="color:var(--accent); font-size:1.8rem" onclick="addTask()"></i>
            </div>
            <div id="taskList"></div>
        </div>

        <div class="footer-rights">
            ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© <span class="m-name">Ù…Ø±ÙˆØ© Ù…Ø­Ù…Ø¯</span> | 
            <a href="https://t.me/wateenPRO" target="_blank">@wateenPRO</a>
        </div>

        <div class="timer-box">
            <div class="time-val" id="timeDisp">40:00</div>
        </div>

        <div class="action-row">
            <button class="btn btn-play" id="mainBtn" onclick="toggleTimer()">Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</button>
            <button class="btn btn-off" onclick="openModal()"><i class="fas fa-power-off"></i></button>
        </div>
    </div>

    <script>
        // Ø¥Ø±Ø¬Ø§Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØµØ§Ø¦Ø­ ÙƒØ§Ù…Ù„Ø©
        const phrases = [
            "ØªØ±Ø§ Ø§Ù„ÙˆØ²Ø§Ø±ÙŠ Ù…ÙŠØ±Ø­Ù…ØŒ Ø±ÙƒØ² ÙŠØ§ Ø¨Ø·Ù„! ğŸ§ ", "Ø¹ÙˆÙ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ ØªØ±Ø§ Ù…Ø§Ø±Ùƒ Ù…ÙŠÙÙŠØ¯Ùƒ Ø¨Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸŒš", "Ø§Ù„Ø¯Ù…Ø§Øº ÙŠØ­ØªØ§Ø¬ ÙØ±Ù…ØªØ© Ø¯Ø±Ø§Ø³ÙŠØ©ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†! ğŸš€",
            "Ø¹Ø¨Ø§Ù„Ùƒ Ù…Ø§ Ø£Ø¯Ø±ÙŠ Ø¨ÙŠÙƒ ØµØ§ÙÙ†ØŸ Ø±ÙƒØ²! ğŸ˜‚", "Ø§Ù„ÙƒØªØ¨ Ø¯Ø§ ØªØ¨Ø¬ÙŠ Ù…Ù† Ù‚Ù„Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² ğŸ“–", "ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù†ÙˆÙ… Ù‡Ø³Ù‡ØŒ ØªÙ‚Ø§Ø¨Ù„Ù‡Ø§ Ø­Ø³Ø±Ø© Ø¨Ø§Ø¬Ø±! ğŸ¤£",
            "ÙŠØ§ Ù…Ø®ØŒ Ø¨Ø·Ù„ ØªÙÙƒØ± Ø¨Ø§Ù„Ø¹Ø´Ø§Ø¡ ÙˆØ±ÙƒØ² Ø¨Ø§Ù„Ù‡Ø¯Ù! ğŸ”", "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø·Ø¹Ù…Ù‡ Ø£Ø·ÙŠØ¨ Ù…Ù† Ø§Ù„ÙƒÙ†Ø§ÙØ©! ğŸ°", "ØªØ±Ø§ ÙˆØ§Ù„Ù„Ù‡ Ù‡Ø§Ù†ØªØŒ Ø¨Ø³ Ø±ÙƒØ² Ø´ÙˆÙŠØ©! ğŸ©º",
            "ÙŠØ§ Ù…Ø®ØŒ Ø£Ù†Øª ÙƒØ¯Ù‡Ø§.. Ø¨Ø³ Ø¨Ø·Ù„ Ø¹Ø¬Ø²! ğŸ§ ", "Ø®Ù„ÙˆÙƒÙ… ÙØ®Ø± Ù„Ù†ÙØ³ÙƒÙ… ÙˆÙ„Ø£Ù‡Ù„ÙƒÙ…! ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "ØªØ±Ø§ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø¯Ø§ ØªØºÙ…Ø² Ù„Ù†Ø§ØŒ Ø±ÙƒØ²ÙˆØ§! ğŸ˜‰",
            "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø¯Ø§ ØªØ·Ø¨Ø® Ù…ÙØ§Ø¬Ø¢Øª Ø¨Ø§Ù„ÙˆØ²Ø§Ø±ÙŠ! ğŸ§ª", "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø­Ø± ÙˆØ¥Ø­Ù†Ø§ Ø¯Ø§ Ù†ØºØ±Ù‚ Ø¨Ø§Ù„ÙƒØ³Ù„! ğŸŒŠ",
            "Ø§Ù„Ù†Ø¬Ø§Ø­ ÙŠØ­Ø¨ Ø§Ù„Ù„ÙŠ ÙŠØªØ¹Ø¨ Ù„Ù‡! ğŸ†", "ÙŠØ§ Ù…Ø®ØŒ Ø£Ù†Øª Ø§Ù„Ù…Ø­Ø±Ùƒ.. Ù„Ø§ ØªØ¹Ø·Ù„! âš™ï¸", "Ø§Ù„ÙØ±Ø­Ø© Ø¨Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ØªÙ†Ø³ÙŠÙ†Ø§ ÙƒÙ„ Ø§Ù„ØªØ¹Ø¨! ğŸ¥³",
            "ØªØ±Ø§ Ø¥Ø­Ù†Ø§ ÙƒØ¯Ù‡Ø§ ÙˆÙ‚Ø¯ÙˆØ¯ØŒ Ù„Ø§ ØªØªØ±Ø§Ø¬Ø¹! ğŸ’ª", "ÙŠÙ„Ø§ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø¨Ø¯ÙˆÙ† ØµÙÙ†Ø§Øª ÙØ§Ø±ØºØ©! ğŸš€", "Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙŠÙ†ØªØ¸Ø±Ù†Ø§ØŒ Ø®Ù„ Ù†ÙƒÙˆÙ† Ù…Ø³ØªØ¹Ø¯ÙŠÙ†! ğŸŒŸ",
            "Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ù‡Ùˆ Ø¬Ø³Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ØŒ Ø§Ø¹Ø¨Ø±Ù‡ Ø§Ù„Ø¢Ù†! ğŸŒ‰", "ØªØ®ÙŠÙ„ Ø§Ø³Ù…Ùƒ Ø¨Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±ÙØŒ ÙˆØ§Ø´ØªØºÙ„! âœ¨", "Ø§Ù„ÙƒØ³Ù„ Ù‡Ùˆ Ø¹Ø¯ÙˆÙƒ Ø§Ù„Ø£ÙˆÙ„ØŒ Ø§Ù‡Ø²Ù…Ù‡! âš”ï¸",
            "ÙŠØ§ Ù…Ø®ØŒ ÙÙƒØ± Ø¨Ø§Ù„ØµØ¯Ø±ÙŠØ© ÙˆØ¹ÙˆÙ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª! ğŸ¥¼", "Ø§Ù„Ù‡Ø¯Ù ÙˆØ§Ø¶Ø­ØŒ Ù„Ø§ ØªØ´ØªØª Ù†ÙØ³Ùƒ! ğŸ¯", "ÙŠØ§ Ø´Ø¹Ø¨ ÙˆØªÙŠÙ†ØŒ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ù‡Ùˆ Ø§Ù„Ø³Ø±! ğŸ”",
            "Ø¹ÙˆÙÙˆØ§ Ø§Ù„Ø³ÙˆØ§Ù„ÙØŒ ØªØ±Ø§ Ù…Ø§ÙƒÙˆ ÙˆÙ‚Øª Ù„Ù„Ù†Ø¯Ù…! âŒ›", "Ø±ÙƒØ²ÙˆØ§ØŒ ØªØ±Ø§ Ø§Ù„Ø¹Ù‚Ù„ Ø¯Ø§ ÙŠØºØ´ Ù…Ù† Ø§Ù„ØªØ¹Ø¨! ğŸ§ ", "ÙŠØ§ Ù…Ø®ØŒ Ø£Ù†Øª Ø£Ø°ÙƒÙ‰ Ù…Ù† Ù‡ÙŠØ¬ØŒ Ø£Ø«Ø¨Øª Ù„Ù†Ø§! ğŸ§ ",
            "ÙŠÙ„Ø§ Ø¬ÙˆÙ„Ø© Ø£Ø®ÙŠØ±Ø© Ø¨Ù‚Ù…Ø© Ø§Ù„ØªØ±ÙƒÙŠØ²! ğŸ”¥", "ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ØªØ¹Ø¨ Ù‡Ø³Ù‡ØŒ Ø±Ø§Ø­Ø© Ø¨Ø§Ø¬Ø±! ğŸ›Œ", "ÙŠØ§ Ø¬Ù…Ø§Ø¹Ø©ØŒ ØªØ±Ø§ ÙˆØ§Ù„Ù„Ù‡ Ù‡Ø§Ù†Øª! âœ¨"
        ];

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, type='short') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            if(type==='done') osc.frequency.exponentialRampToValueAtTime(freq+500, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.03, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        }

        let timeLeft = 40 * 60;
        let timer = null;
        let isRunning = false;
        let studyCount = 0;
        let tasks = JSON.parse(localStorage.getItem('wateen_pro_v77')) || [];

        const h = new Date().getHours();
        document.getElementById('greetText').innerText = h < 12 ? "Ø·Ø§Ø¨ Ù†Ù‡Ø§Ø±ÙƒÙ…â€¦ ÙˆÙˆÙ‚Øª Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ âœ¨" : "Ø·Ø§Ø¨ ÙŠÙˆÙ…ÙƒÙ…â€¦ ÙˆÙˆÙ‚Øª Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ âœ¨";
        
        setTimeout(() => { 
            document.getElementById('splash').style.opacity='0'; 
            setTimeout(()=>document.getElementById('splash').style.display='none',1200); 
        }, 10000);

        window.onload = () => { renderTasks(); updateUI(); };

        function triggerToast(m) {
            document.getElementById('toastMsg').innerText = m;
            document.getElementById('toast').classList.add('show');
            setTimeout(()=>document.getElementById('toast').classList.remove('show'), 4000);
        }

        function addTask() {
            const inp = document.getElementById('taskInp');
            if(inp.value.trim()){
                tasks.push({id: Date.now(), text: inp.value.trim(), done: false});
                inp.value = ''; playSfx(800); sync();
                triggerToast(phrases[Math.floor(Math.random()*phrases.length)]);
            }
        }

        function sync() { localStorage.setItem('wateen_pro_v77', JSON.stringify(tasks)); renderTasks(); }

        function renderTasks() {
            document.getElementById('taskList').innerHTML = tasks.map(t => `
                <div class="task-card ${t.done?'done':''}">
                    <span>${t.text}</span>
                    <div class="check-icon ${t.done?'active':''}" onclick="checkTask(${t.id})">
                        <i class="fas fa-check" style="font-size:0.75rem"></i>
                    </div>
                </div>`).join('');
        }

        function checkTask(id) {
            if(isRunning) { triggerToast("Ø±ÙƒØ² Ø¨Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ù‡Ø³Ø© ÙˆØ¹ÙˆÙ Ø§Ù„Ù…Ù‡Ø§Ù…! ğŸŒš"); return; }
            tasks = tasks.map(t => {
                if(t.id === id) {
                    if(!t.done) playSfx(1000, 'done'); else playSfx(600);
                    return {...t, done: !t.done};
                }
                return t;
            });
            sync();
        }

        function updateUI() {
            const m = Math.floor(timeLeft/60); const s = timeLeft%60;
            document.getElementById('timeDisp').innerText = `${m}:${s<10?'0':''}${s}`;
        }

        function toggleTimer() {
            playSfx(700);
            if(tasks.length === 0) { triggerToast("Ø£Ø¶Ù Ø£Ù‡Ø¯Ø§ÙÙƒ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡! ğŸŒš"); return; }
            const btn = document.getElementById('mainBtn');
            if(isRunning) {
                clearInterval(timer); isRunning = false;
                btn.innerText = "Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„ØªÙ†ÙÙŠØ°"; btn.classList.remove('active');
                triggerToast("Ø¹Ø¨Ø§Ù„Ùƒ Ù…Ø§ Ø£Ø¯Ø±ÙŠ Ø¨ÙŠÙƒØŸ ØªØ±Ù‡ Ù…Ø±Ø§Ù‚Ø¨Ùƒ! ğŸ‘ï¸ Ù„Ø§ ØªØ³Ø®Øª!");
            } else {
                isRunning = true;
                btn.innerText = "ØªÙˆÙ‚Ù Ù…Ø¤Ù‚Øª"; btn.classList.add('active');
                triggerToast(phrases[Math.floor(Math.random()*phrases.length)]);
                timer = setInterval(() => {
                    timeLeft--; updateUI();
                    if(timeLeft <= 0) {
                        clearInterval(timer); isRunning = false;
                        studyCount++; document.getElementById('sc').innerText = `${studyCount}/12`;
                        playSfx(1500, 'done');
                        triggerToast("ÙƒÙÙˆÙˆÙˆ! Ø¬ÙˆÙ„Ø© ÙƒØ§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ¥³");
                    }
                }, 1000);
            }
        }

        // Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù€ Modal ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ„Ø­Ø©
        function openModal() { playSfx(400); document.getElementById('ios-modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('ios-modal').style.display = 'none'; }
        
        function appReset() {
            playSfx(200);
            localStorage.clear();
            tasks = [];
            studyCount = 0;
            timeLeft = 40 * 60;
            document.getElementById('sc').innerText = "0/12";
            document.getElementById('rc').innerText = "0/12";
            document.getElementById('timeDisp').innerText = "40:00";
            sync();
            closeModal();
            triggerToast("ØªÙ… ØªØµÙÙŠØ± ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ù†Ø¬Ø§Ø­! ğŸš€");
        }
    </script>
</body>
</html>

        function showAlert(msg, iconClass = 'fa-ghost') {
            const box = document.getElementById('alertBox');
            document.getElementById('alertMsg').innerText = msg;
            document.getElementById('alertIcon').className = `fas ${iconClass}`;
            box.classList.add('active');
            setTimeout(() => box.classList.remove('active'), 3500);
        }

        function addTask() {
            const inp = document.getElementById('tInput');
            if(inp.value.trim()) {
                tasks.push({id: Date.now(), text: inp.value.trim(), done: false});
                inp.value = ''; save(); playSound(600);
            } else { showAlert("Ø¶ÙŠÙÙŠ Ø£Ù‡Ø¯Ø§Ù Ø£ÙˆÙ„Ø§Ù‹ ÙŠØ§ ÙˆØªÙŠÙ†! ğŸŒš", "fa-clipboard-list"); }
        }

        function save() { localStorage.setItem('wateen_final_v1', JSON.stringify(tasks)); render(); }

        function render() {
            document.getElementById('tList').innerHTML = tasks.map(t => `
                <div class="task-card">
                    <span style="font-family:'Tajawal'; font-weight:800; ${t.done ? 'text-decoration:line-through; opacity:0.3':''}">${t.text}</span>
                    <div class="check-btn ${t.done?'done':''}" onclick="checkTask(${t.id})"><i class="fas fa-check"></i></div>
                </div>`).join('');
        }

        function checkTask(id) {
            if(isRunning) {
                showAlert(roasts[Math.floor(Math.random()*roasts.length)], "fa-hand-paper");
                playSound(150, 'square', 0.2); return;
            }
            tasks = tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
            save(); playSound(800);
        }

        function updateUI() {
            const m = Math.floor(timeLeft / 60); const s = timeLeft % 60;
            document.getElementById('tDisplay').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        function handleTimer() {
            if(tasks.length === 0) { showAlert("Ø¶ÙŠÙÙŠ Ø£Ù‡Ø¯Ø§Ù Ø£ÙˆÙ„Ø§Ù‹! ğŸŒš", "fa-clipboard-list"); return; }
            const btn = document.getElementById('startBtn');
            if(isRunning) {
                isRunning = false; clearInterval(timer);
                btn.innerText = "Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"; btn.className = "btn btn-main";
                playSound(150, 'triangle', 0.4); 
                showAlert("ØªÙ… Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­.. Ù„Ø§ ØªØ·ÙˆÙ„ÙŠÙ†! ğŸ¥¶", "fa-snowflake");
            } else {
                isRunning = true;
                btn.innerText = "ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ù†ØµØ¨"; btn.className = "btn btn-main active-mode";
                playSound(500);
                timer = setInterval(() => { 
                    timeLeft--; updateUI(); 
                    if(timeLeft <= 0) { clearInterval(timer); isRunning = false; playSound(1000, 'sine', 0.5); }
                }, 1000);
            }
        }

        function openSheet() { playSound(150, 'sawtooth'); document.getElementById('sheetOverlay').style.display = 'flex'; }
        function closeSheet() { document.getElementById('sheetOverlay').style.display = 'none'; }
        
        function confirmReset() {
            localStorage.removeItem('wateen_final_v1');
            tasks = []; timeLeft = 40 * 60; isRunning = false; clearInterval(timer);
            document.getElementById('startBtn').innerText = "Ø¨Ø¯Ø¡ Ø§Ù„Ù†ØµØ¨";
            document.getElementById('startBtn').className = "btn btn-main";
            render(); updateUI(); closeSheet();
            showAlert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù….. Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ Ù…Ø±ÙˆØ© ğŸ› ï¸", "fa-sync-alt");
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„Ù„Ù€ PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW Error', err));
            });
        }
    </script>
</body>
</html>
