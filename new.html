<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÙˆØªÙŠÙ† | Memory Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="data:application/json;base64,ewogICJkZWZhdWx0X2xvY2FsZSI6ICJhciIsCiAgIm5hbWUiOiAi2YjYqtmK2YYgTWVtb3J5IiwKICAic2hvcnRfbmFtZSI6ICJcdTA2NDhcdTA2MjlcdTA2MmFcdTA2NGEiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBhMGEwYyIsCiAgInRoZW1lX2NvbG9yIjogIiMwMGQyZmYiCn0=">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #00d2ff; --bg: #0a0a0c; --card: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Cairo', sans-serif; background: var(--bg); color: white; overflow: hidden; }
        .app-container { height: 100%; display: flex; flex-direction: column; padding: 20px; padding-top: 40px; }
        .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat-box { background: var(--card); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 18px; text-align: center; }
        .stat-box b { display: block; font-size: 1.3rem; color: var(--accent); font-weight: 900; }
        .screen { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; animation: fadeIn 0.4s ease; }
        .hidden { display: none !important; }
        #word-screen { font-size: 5.5rem; font-weight: 900; text-shadow: 0 0 25px var(--accent); text-align: center; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 500px; }
        .ios-field { background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 18px; color: white; font-family: 'Cairo'; text-align: center; font-size: 1.2rem; font-weight: 700; -webkit-user-select: text; }
        .btn-ios { background: var(--accent); color: #000; border: none; padding: 22px; border-radius: 22px; font-weight: 900; font-size: 1.3rem; width: 100%; max-width: 400px; cursor: pointer; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,210,255,0.2); }
        .review-list { width: 100%; max-width: 500px; max-height: 180px; overflow-y: auto; background: var(--card); border-radius: 20px; padding: 10px; margin-top: 15px; }
        .review-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-weight: 700; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="app-container">
    <div class="stats-bar">
        <div class="stat-box"><span>Ø§Ù„ÙŠÙˆÙ…</span><b id="d-val">0</b></div>
        <div class="stat-box"><span>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span><b id="w-val">0</b></div>
        <div class="stat-box"><span>Ø§Ù„Ø´Ù‡Ø±</span><b id="m-val">0</b></div>
    </div>

    <div class="screen" id="scr-start">
        <h1 style="font-weight: 900; font-size: 2.8rem; margin:0; color: var(--accent);">Memory Matrix</h1>
        <p id="limit-info" style="opacity: 0.6; font-weight: 700;">Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­Ø¯ÙŠ ÙŠØ§ ÙˆØªÙŠÙ†ØŸ (15 Ø¬Ù„Ø³Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹)</p>
        <button class="btn-ios" id="btn-start" onclick="startApp()">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    </div>

    <div class="screen hidden" id="scr-show">
        <div id="word-screen">---</div>
    </div>

    <div class="screen hidden" id="scr-input">
        <div class="input-grid" id="grid-inputs"></div>
        <button class="btn-ios" onclick="evaluateApp()">ÙƒØ´Ù Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    </div>

    <div class="screen hidden" id="scr-res">
        <h1 id="final-score" style="font-size: 4rem; color: var(--accent); margin:0;">0%</h1>
        <div style="width:100%; max-width:400px; height:180px;"><canvas id="scoreChart"></canvas></div>
        <div class="review-list" id="review-box"></div>
        <button class="btn-ios" onclick="resetApp()">Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>
</div>

<script>
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù†Øª
    if ('serviceWorker' in navigator) {
        const sw = `self.addEventListener('install', e => e.waitUntil(caches.open('v1').then(c => c.addAll(['./']))));
                    self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));`;
        const blob = new Blob([sw], {type: 'text/javascript'});
        navigator.serviceWorker.register(URL.createObjectURL(blob));
    }

    const dataPool = ["Ù…ØªØ³Ø¹Ø©", "Ø£ÙˆÙ…", "ØªÙƒØ§Ù…Ù„", "Ù…Ø´ØªÙ‚Ø©", "DNA", "Ø¨Ù†Ø²ÙŠÙ†", "Ø­Ù…Ø¶", "Ù‚Ø§Ø¹Ø¯Ø©", "Ù†ÙŠÙˆØªÙ†", "ÙÙˆÙ„Øª", "Ø³Ø§ÙŠØªÙˆØ¨Ù„Ø§Ø²Ù…", "77", "9", "X", "Physics", "Bio", "Chem", "ÙˆØªÙŠÙ†", "Ù…Ø±ÙˆØ©", "ğŸ’¡", "ğŸš€"];
    let sessionWords = [];
    let stats = JSON.parse(localStorage.getItem('utin_final_v12')) || { day: 0, week: 0, month: 0, history: [], dailyCount: 0, lastDate: "" };
    let chart;

    function normalize(text) {
        return text.toString().trim()
            .replace(/[Ø£Ø¥Ø¢]/g, 'Ø§')
            .replace(/Ø©/g, 'Ù‡')
            .replace(/\s+/g, '')
            .toLowerCase();
    }

    function startApp() {
        if(stats.dailyCount >= 15 && stats.lastDate === new Date().toDateString()) return;
        stats.dailyCount++; stats.lastDate = new Date().toDateString(); save();
        switchScr('scr-show');
        sessionWords = [...dataPool].sort(() => Math.random() - 0.5).slice(0, 10);
        let i = 0;
        let timer = setInterval(() => {
            if(i < 10) { document.getElementById('word-screen').innerText = sessionWords[i++]; }
            else { clearInterval(timer); setupInput(); }
        }, 1500);
    }

    function setupInput() {
        switchScr('scr-input');
        const grid = document.getElementById('grid-inputs');
        grid.innerHTML = '';
        for(let i=0; i<10; i++) grid.innerHTML += `<input type="text" class="ios-field" placeholder="${i+1}">`;
    }

    function evaluateApp() {
        const userVals = Array.from(document.querySelectorAll('.ios-field')).map(f => normalize(f.value));
        let score = 0; let html = '';
        sessionWords.forEach(word => {
            const isOk = userVals.includes(normalize(word));
            if(isOk) score++;
            html += `<div class="review-item"><span>${word}</span><span style="color:${isOk?'#00ff88':'#ff4b5c'}">${isOk?'âœ“':'âœ—'}</span></div>`;
        });
        const final = score * 10;
        stats.day += final; stats.week += final; stats.month += final;
        stats.history.push(final); if(stats.history.length > 5) stats.history.shift();
        save();
        document.getElementById('final-score').innerText = final + "%";
        document.getElementById('review-box').innerHTML = html;
        switchScr('scr-res'); drawChart();
    }

    function drawChart() {
        const ctx = document.getElementById('scoreChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'bar',
            data: { labels: stats.history.map((_, i) => i+1), datasets: [{ data: stats.history, backgroundColor: '#00d2ff', borderRadius: 8 }] },
            options: { scales: { y: { beginAtZero: true, max: 100 } }, plugins: { legend: { display: false } } }
        });
    }

    function switchScr(id) { document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    function save() { localStorage.setItem('utin_final_v12', JSON.stringify(stats)); updateUI(); }
    function updateUI() {
        document.getElementById('d-val').innerText = stats.day;
        document.getElementById('w-val').innerText = stats.week;
        document.getElementById('m-val').innerText = stats.month;
        if(stats.dailyCount >= 15) { document.getElementById('btn-start').disabled = true; document.getElementById('limit-info').innerText = "ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ 15/15"; }
    }
    function resetApp() { switchScr('scr-start'); }
</script>
</body>
</html>
